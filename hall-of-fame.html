<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Borderville Stats â€“ Hall of Fame</title>

  <link rel="stylesheet" href="./css/styles.css" />

  <!-- Page-specific styling kept here to avoid destabilising shared CSS -->
    <style>
    .hof-wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 16px 48px;
    }

    .hof-header{
      text-align: center;
      margin: 10px 0 22px;
      opacity: 0.95;
    }

    .hof-header .title{
      font-size: 22px;
      font-weight: 900;
      letter-spacing: 0.3px;
    }

    .hof-header .sub{
      margin-top: 6px;
      opacity: 0.7;
      font-size: 14px;
    }

    .year-block{
      margin-top: 26px;
      padding-top: 18px;
    }

    .year-title{
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: 0.4px;
      margin-bottom: 12px;
      opacity: 0.95;
    }
    .year-title::after{
      content: "";
      height: 1px;
      flex: 1 1 auto;
      background: rgba(255,255,255,0.12);
    }

    /* Mini-cards in horizontal rows */
    .awards-list{
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 980px){
      .awards-list{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 620px){
      .awards-list{ grid-template-columns: 1fr; }
    }

    .award-card{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 12px 12px;
      backdrop-filter: blur(8px);
      display: grid;
      gap: 10px;
      min-height: 96px;
    }

    .award-name{
      font-size: 12px;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      opacity: 0.82;
      line-height: 1.2;
    }

    .winners{
      display: grid;
      gap: 8px;
    }

    .winner{
      display: flex;
      align-items: center;
      gap: 10px;
      min-height: 34px;
    }

    .winner__photo{
      width: 32px;
      height: 32px;
      border-radius: 999px;
      object-fit: cover;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      flex: 0 0 auto;
    }

    .winner__photo--fallback{
      display: inline-block;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      opacity: 0.5;
      flex: 0 0 auto;
    }

    .winner__name{
      font-size: 15px;
      font-weight: 900;
      letter-spacing: 0.2px;
      line-height: 1.1;
    }

    .award-notes{
      font-size: 13px;
      opacity: 0.82;
      line-height: 1.3;
      margin-top: 2px;
    }

    .error{
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 16px;
    }

    .tiny{
      margin-top: 8px;
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
    }
  </style>
</head>

<body>
  <!-- Topbar Nav -->
  <header class="topbar">
    <div class="topbar__inner">
      <a class="topbar__brand" href="index.html">Borderville Stats</a>

      <button class="topbar__toggle" aria-expanded="false" aria-controls="topbarLinks">
        Menu
      </button>

      <nav id="topbarLinks" class="topbar__links">
        <a href="index.html">Players</a>
        <a href="results.html">Results</a>
        <a href="hall-of-fame.html" aria-current="page">Hall of Fame</a>
        <a href="rules.html">Rules</a>
      </nav>
    </div>
  </header>

  <main class="hof-wrap">
    <div class="hof-header">
      <div class="title">Hall of Fame</div>
    </div>

    <div id="hofRoot"></div>
    <div id="hofError" class="error" style="display:none;"></div>
  </main>

  <script>

  (function(){
    const HOF_URL = "./data/hall-of-fame.json";
    const AGG_URL = "./data/aggregated.json"; // used only to resolve IDs -> names

    const root = document.getElementById("hofRoot");
    const errorEl = document.getElementById("hofError");

    function showError(msg){
      errorEl.style.display = "block";
      errorEl.textContent = msg;
    }

    const AWARD_PRIORITY = new Map([
  ["players' player", 1],
  ["golden boot", 2],
  ["goal of the season", 3],
  ["golden glove", 4],
  ["most assists", 5],
  ["best defensive partnership", 6],
  ["most improved", 7],
  ["player of the year", 8],
  ["most motm", 9],
]);

function awardSortKey(awardName){
  const k = String(awardName || "").trim().toLowerCase();
  const p = AWARD_PRIORITY.get(k) ?? 999;
  return [p, k];
}

    function photoPathFromName(name) {
      if (!name || typeof name !== "string") return null;
      // Case-sensitive hosting (GitHub Pages) means filename casing must match.
      // Repo convention: First_Last.png (capital initials), so preserve casing and just underscore spaces.
      const safe = name.trim().replace(/\s+/g, "_");
      return `./images/playerPhotos/${encodeURIComponent(safe)}.png`;
    }

    function isProbablyPlayerId(val){
      // Airtable-like record IDs in your system look like "rec..."
      return typeof val === "string" && /^rec[a-zA-Z0-9]+$/.test(val.trim());
    }

    function winnerRowFromName(name){
      const row = document.createElement("div");
      row.className = "winner";

      const img = document.createElement("img");
      img.className = "winner__photo";
      img.alt = name;      img.src = photoPathFromName(name);
img.onerror = () => {
        img.onerror = null;
        img.src = "./images/playerPhotos/No_Photo.png";
        img.classList.add("winner__photo--fallback");
      };

      const n = document.createElement("div");
      n.className = "winner__name";
      n.textContent = name;

      row.appendChild(img);
      row.appendChild(n);
      return row;
    }

    function winnerRowFromWinnerValue(w, playersById){
      // Winner values may be player IDs OR names.
      if (isProbablyPlayerId(w)) {
        const p = playersById[w];
        const resolvedName = (p && p.name) ? p.name : "Unknown";
        return winnerRowFromName(resolvedName);
      }
      // Plain name string
      if (typeof w === "string" && w.trim()) return winnerRowFromName(w.trim());
      return winnerRowFromName("Unknown");
    }

    function render(hofData, playersById){
      const years = (hofData.years || []).slice().sort((a,b) => b.year - a.year);
      if(!years.length){
        showError("No Hall of Fame entries found.");
        return;
      }

      years.forEach(y => {
        const block = document.createElement("section");
        block.className = "year-block";

        const title = document.createElement("div");
        title.className = "year-title";
        title.textContent = y.year;
        block.appendChild(title);

        const list = document.createElement("div");
        list.className = "awards-list";

        (y.awards || []).slice().sort((a,b)=>{
          const [pa,ka]=awardSortKey(a.award);
          const [pb,kb]=awardSortKey(b.award);
          if (pa!==pb) return pa-pb;
          return ka.localeCompare(kb);
        }).forEach(a => {
          const card = document.createElement("div");
          card.className = "award-card";

          const awardName = document.createElement("div");
          awardName.className = "award-name";
          awardName.textContent = a.award || "Award";
          card.appendChild(awardName);

          const winnersWrap = document.createElement("div");
          winnersWrap.className = "winners";

          const winners = Array.isArray(a.winners) ? a.winners : [];
          winners.forEach(w => winnersWrap.appendChild(winnerRowFromWinnerValue(w, playersById)));

          card.appendChild(winnersWrap);

          if (a.notes){
            const notes = document.createElement("div");
            notes.className = "award-notes";
            notes.textContent = a.notes;
            card.appendChild(notes);
          }

          list.appendChild(card);
        });

        block.appendChild(list);
        root.appendChild(block);
      });
    }

    // Load both JSONs (aggregated.json is optional, but enables ID -> name resolution)
    Promise.all([
      fetch(HOF_URL, { cache: "no-store" }).then(r => {
        if(!r.ok) throw new Error("Failed to load hall-of-fame.json");
        return r.json();
      }),
      fetch(AGG_URL, { cache: "no-store" })
        .then(r => r.ok ? r.json() : null)
        .catch(() => null)
    ])
      .then(([hofData, agg]) => {
        const playersById = (agg && agg.players) ? agg.players : {};
        render(hofData, playersById);
      })
      .catch(err => {
        console.error(err);
        showError(err.message || "Failed to load Hall of Fame.");
      });

    // Minimal topbar menu toggle (so this page works even if you don't load app.js here)
    (function initTopbarMenu(){
      const btn = document.querySelector(".topbar__toggle");
      const links = document.getElementById("topbarLinks");
      if (!btn || !links) return;

      btn.addEventListener("click", () => {
        const open = links.classList.toggle("is-open");
        btn.setAttribute("aria-expanded", open ? "true" : "false");
      });

      document.addEventListener("click", (e) => {
        if (!links.classList.contains("is-open")) return;
        if (links.contains(e.target) || btn.contains(e.target)) return;
        links.classList.remove("is-open");
        btn.setAttribute("aria-expanded", "false");
      });
    })();
  })();
</script>
</body>
</html>
